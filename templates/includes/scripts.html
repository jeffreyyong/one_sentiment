<script>
const pollResult = (uuid) => {
    let url ='/result/' + uuid
    fetch(url)
    .then(response => {
        return response.json()
    })
    .then(data => {
        console.log(JSON.stringify(data))
        document.getElementById("result").innerHTML = data.result
    })
    .catch(err=>{ 
        window.setTimeout(pollResult, 1000)
        console.log(err)
    })
}

const sendParameters = () => {
    let language = document.getElementById("language").value
    let number = document.getElementById("destination").value

    let body = {
            language: language,
            number: number
        }
    let url ='/asr'
    let param = {
        headers: {
            "Content-Type": "application/json; charset=utf-8",
        },
        method: 'POST',
        body: JSON.stringify(body)
    }
    console.log('backend url ' + url)
    
    fetch(url, param)
    .then(response => {
        return response.json()
    })
    .then(data => {
        console.log(JSON.stringify(data))
        pollResult(data.uuid)
    })
}

const main = () => {
    document.getElementById('sendButton').addEventListener("click", sendParameters)
}

window.addEventListener("load", main)
</script>